{"version":3,"sources":["./src/core/features/tag/pages/index/index.html","./src/core/features/tag/pages/index/index.page.module.ts","./src/core/features/tag/pages/index/index.page.ts"],"names":[],"mappings":"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","file":"features-tag-pages-index-index-page-module.js","sourcesContent":["export default \"<ion-header>\\r\\n    <ion-toolbar>\\r\\n        <ion-buttons slot=\\\"start\\\">\\r\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\r\\n        </ion-buttons>\\r\\n        <ion-title>\\r\\n            <h1>{{ 'core.tag.tag' | translate }}: {{ tagName }}</h1>\\r\\n        </ion-title>\\r\\n    </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content>\\r\\n    <core-split-view>\\r\\n        <ion-refresher slot=\\\"fixed\\\" [disabled]=\\\"!loaded\\\" (ionRefresh)=\\\"refreshData($event.target)\\\">\\r\\n            <ion-refresher-content pullingText=\\\"{{ 'core.pulltorefresh' | translate }}\\\"></ion-refresher-content>\\r\\n        </ion-refresher>\\r\\n        <core-loading [hideUntil]=\\\"loaded\\\">\\r\\n            <ion-list *ngIf=\\\"hasUnsupportedAreas || areas.length\\\">\\r\\n                <ion-item *ngIf=\\\"hasUnsupportedAreas\\\" class=\\\"core-warning-item\\\">\\r\\n                    <ion-icon slot=\\\"start\\\" name=\\\"fas-exclamation-triangle\\\" color=\\\"warning\\\" aria-hidden=\\\"true\\\"></ion-icon>\\r\\n                    <ion-label class=\\\"ion-text-wrap\\\">{{ 'core.tag.warningareasnotsupported' | translate }}</ion-label>\\r\\n                </ion-item>\\r\\n                <ion-item class=\\\"ion-text-wrap\\\" *ngFor=\\\"let area of areas\\\" [attr.aria-label]=\\\"area.nameKey | translate\\\"\\r\\n                    (click)=\\\"openArea(area)\\\" [attr.aria-current]=\\\"area!.id == selectedAreaId ? 'page' : 'false'\\\" button detail=\\\"true\\\">\\r\\n                    <ion-label>\\r\\n                        <h2>{{ area!.nameKey | translate }}</h2>\\r\\n                    </ion-label>\\r\\n                    <ion-badge slot=\\\"end\\\" *ngIf=\\\"area!.badge\\\">\\r\\n                        <span aria-hidden=\\\"true\\\">{{ area!.badge }}</span>\\r\\n                        <span class=\\\"sr-only\\\">{{ 'core.tag.tagareabadgedescription' | translate:{ count: area!.badge } }}</span>\\r\\n                    </ion-badge>\\r\\n                </ion-item>\\r\\n            </ion-list>\\r\\n            <core-empty-box icon=\\\"fas-tag\\\" *ngIf=\\\"!hasUnsupportedAreas && (!areas || !areas.length)\\\"\\r\\n                [message]=\\\"'core.tag.noresultsfor' | translate: { $a: tagName }\\\"></core-empty-box>\\r\\n        </core-loading>\\r\\n    </core-split-view>\\r\\n</ion-content>\\r\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { conditionalRoutes } from '@/app/app-routing.module';\r\nimport { CoreTagIndexAreaRoute } from '@features/tag/tag-lazy.module';\r\nimport { CoreScreen } from '@services/screen';\r\n\r\nimport { CoreSharedModule } from '@/core/shared.module';\r\nimport { CoreTagIndexPage } from './index.page';\r\n\r\nconst mobileRoutes: Routes = [\r\n    {\r\n        path: '',\r\n        component: CoreTagIndexPage,\r\n    },\r\n    CoreTagIndexAreaRoute,\r\n];\r\n\r\nconst tabletRoutes: Routes = [\r\n    {\r\n        path: '',\r\n        component: CoreTagIndexPage,\r\n        children: [\r\n            CoreTagIndexAreaRoute,\r\n        ],\r\n    },\r\n];\r\n\r\nconst routes: Routes = [\r\n    ...conditionalRoutes(mobileRoutes, () => CoreScreen.isMobile),\r\n    ...conditionalRoutes(tabletRoutes, () => CoreScreen.isTablet),\r\n];\r\n\r\n@NgModule({\r\n    declarations: [\r\n        CoreTagIndexPage,\r\n    ],\r\n    imports: [\r\n        RouterModule.forChild(routes),\r\n        CoreSharedModule,\r\n    ],\r\n    exports: [RouterModule],\r\n})\r\nexport class CoreTagIndexPageModule {}\r\n","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { IonRefresher } from '@ionic/angular';\r\nimport { CoreDomUtils } from '@services/utils/dom';\r\nimport { CoreTag } from '@features/tag/services/tag';\r\nimport { CoreTagAreaDelegate } from '@features/tag/services/tag-area-delegate';\r\nimport { CoreScreen } from '@services/screen';\r\nimport { CoreNavigator } from '@services/navigator';\r\n\r\n/**\r\n * Page that displays the tag index.\r\n */\r\n@Component({\r\n    selector: 'page-core-tag-index',\r\n    templateUrl: 'index.html',\r\n})\r\nexport class CoreTagIndexPage implements OnInit {\r\n\r\n    tagId = 0;\r\n    tagName = '';\r\n    collectionId = 0;\r\n    areaId = 0;\r\n    fromContextId = 0;\r\n    contextId = 0;\r\n    recursive = true;\r\n    loaded = false;\r\n    selectedAreaId?: number;\r\n    hasUnsupportedAreas = false;\r\n\r\n    areas: CoreTagAreaDisplay[] = [];\r\n\r\n    /**\r\n     * View loaded.\r\n     */\r\n    async ngOnInit(): Promise<void> {\r\n        this.tagId = CoreNavigator.getRouteNumberParam('tagId') || this.tagId;\r\n        this.tagName = CoreNavigator.getRouteParam('tagName') || this.tagName;\r\n        this.collectionId = CoreNavigator.getRouteNumberParam('collectionId') || this.collectionId;\r\n        this.areaId = CoreNavigator.getRouteNumberParam('areaId') || this.areaId;\r\n        this.fromContextId = CoreNavigator.getRouteNumberParam('fromContextId') || this.fromContextId;\r\n        this.contextId = CoreNavigator.getRouteNumberParam('contextId') || this.contextId;\r\n        this.recursive = CoreNavigator.getRouteBooleanParam('recursive') ?? true;\r\n\r\n        try {\r\n            await this.fetchData();\r\n            if (CoreScreen.isTablet && this.areas && this.areas.length > 0) {\r\n                const area = this.areas.find((area) => area.id == this.areaId);\r\n                this.openArea(area || this.areas[0]);\r\n            }\r\n        } finally {\r\n            this.loaded = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fetch first page of tag index per area.\r\n     *\r\n     * @return Resolved when done.\r\n     */\r\n    async fetchData(): Promise<void> {\r\n        try {\r\n            const areas = await CoreTag.getTagIndexPerArea(\r\n                this.tagId,\r\n                this.tagName,\r\n                this.collectionId,\r\n                this.areaId,\r\n                this.fromContextId,\r\n                this.contextId,\r\n                this.recursive,\r\n                0,\r\n            );\r\n\r\n            this.areas = [];\r\n            this.hasUnsupportedAreas = false;\r\n\r\n            const areasDisplay: CoreTagAreaDisplay[] = [];\r\n\r\n            await Promise.all(areas.map(async (area) => {\r\n                const items = await CoreTagAreaDelegate.parseContent(area.component, area.itemtype, area.content);\r\n\r\n                if (!items || !items.length) {\r\n                    // Tag area not supported, skip.\r\n                    this.hasUnsupportedAreas = true;\r\n\r\n                    return;\r\n                }\r\n\r\n                areasDisplay.push({\r\n                    id: area.ta,\r\n                    componentName: area.component,\r\n                    itemType: area.itemtype,\r\n                    nameKey: CoreTagAreaDelegate.getDisplayNameKey(area.component, area.itemtype),\r\n                    items,\r\n                    canLoadMore: !!area.nextpageurl,\r\n                    badge: items && items.length ? items.length + (area.nextpageurl ? '+' : '') : '',\r\n                });\r\n            }));\r\n\r\n            this.areas = areasDisplay;\r\n\r\n        } catch (error) {\r\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading tag index');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Refresh data.\r\n     *\r\n     * @param refresher Refresher.\r\n     */\r\n    refreshData(refresher?: IonRefresher): void {\r\n        CoreTag.invalidateTagIndexPerArea(\r\n            this.tagId,\r\n            this.tagName,\r\n            this.collectionId,\r\n            this.areaId,\r\n            this.fromContextId,\r\n            this.contextId,\r\n            this.recursive,\r\n        ).finally(() => {\r\n            this.fetchData().finally(() => {\r\n                refresher?.complete();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Navigate to an index area.\r\n     *\r\n     * @param area Area.\r\n     */\r\n    openArea(area: CoreTagAreaDisplay): void {\r\n        this.selectedAreaId = area.id;\r\n\r\n        const params = {\r\n            tagId: this.tagId,\r\n            tagName: this.tagName,\r\n            collectionId: this.collectionId,\r\n            areaId: area.id,\r\n            fromContextId: this.fromContextId,\r\n            contextId: this.contextId,\r\n            recursive: this.recursive,\r\n            areaNameKey: area.nameKey,\r\n            componentName: area.componentName,\r\n            itemType: area.itemType,\r\n            items: area.items.slice(),\r\n            canLoadMore: area.canLoadMore,\r\n            nextPage: 1,\r\n        };\r\n\r\n        const splitViewLoaded = CoreNavigator.isCurrentPathInTablet('**/tag/index/index-area');\r\n        const path = (splitViewLoaded ? '../' : '') + 'index-area';\r\n\r\n        CoreNavigator.navigate(path, { params });\r\n    }\r\n\r\n}\r\n\r\nexport type CoreTagAreaDisplay = {\r\n    id: number;\r\n    componentName: string;\r\n    itemType: string;\r\n    nameKey: string;\r\n    items: unknown[];\r\n    canLoadMore: boolean;\r\n    badge: string;\r\n};\r\n"],"sourceRoot":"webpack:///"}