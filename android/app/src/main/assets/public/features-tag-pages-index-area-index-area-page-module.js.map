{"version":3,"sources":["./src/core/features/tag/pages/index-area/index-area.html","./src/core/features/tag/pages/index-area/index-area.page.module.ts","./src/core/features/tag/pages/index-area/index-area.page.ts"],"names":[],"mappings":"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","file":"features-tag-pages-index-area-index-area-page-module.js","sourcesContent":["export default \"<ion-header>\\r\\n    <ion-toolbar>\\r\\n        <ion-buttons slot=\\\"start\\\">\\r\\n            <ion-back-button [text]=\\\"'core.back' | translate\\\"></ion-back-button>\\r\\n        </ion-buttons>\\r\\n        <ion-title>\\r\\n            <h1>\\r\\n                {{ 'core.tag.itemstaggedwith' | translate: { $a: {tagarea: areaNameKey | translate, tag: tagName} } }}\\r\\n            </h1>\\r\\n        </ion-title>\\r\\n    </ion-toolbar>\\r\\n</ion-header>\\r\\n<ion-content class=\\\"limited-width\\\">\\r\\n    <ion-refresher slot=\\\"fixed\\\" [disabled]=\\\"!loaded\\\" (ionRefresh)=\\\"refreshData($event.target)\\\">\\r\\n        <ion-refresher-content pullingText=\\\"{{ 'core.pulltorefresh' | translate }}\\\"></ion-refresher-content>\\r\\n    </ion-refresher>\\r\\n    <core-loading [hideUntil]=\\\"loaded\\\">\\r\\n        <core-dynamic-component [component]=\\\"areaComponent\\\" [data]=\\\"{items: items}\\\"></core-dynamic-component>\\r\\n        <core-infinite-loading [enabled]=\\\"canLoadMore\\\" (action)=\\\"loadMore($event)\\\" [error]=\\\"loadMoreError\\\">\\r\\n        </core-infinite-loading>\\r\\n    </core-loading>\\r\\n</ion-content>\\r\\n\";","// (C) Copyright 2015 Moodle Pty Ltd.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\n\r\nimport { CoreSharedModule } from '@/core/shared.module';\r\nimport { CoreTagIndexAreaPage } from './index-area.page';\r\n\r\nconst routes: Routes = [\r\n    {\r\n        path: '',\r\n        component: CoreTagIndexAreaPage,\r\n    },\r\n];\r\n\r\n@NgModule({\r\n    declarations: [\r\n        CoreTagIndexAreaPage,\r\n    ],\r\n    imports: [\r\n        RouterModule.forChild(routes),\r\n        CoreSharedModule,\r\n    ],\r\n    exports: [RouterModule],\r\n})\r\nexport class CoreTagIndexAreaPageModule {}\r\n","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnInit, Type } from '@angular/core';\nimport { IonRefresher } from '@ionic/angular';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreTag } from '@features/tag/services/tag';\nimport { ActivatedRoute } from '@angular/router';\nimport { CoreTagAreaDelegate } from '../../services/tag-area-delegate';\nimport { Translate } from '@singletons';\nimport { CoreNavigator } from '@services/navigator';\n\n/**\n * Page that displays the tag index area.\n */\n@Component({\n    selector: 'page-core-tag-index-area',\n    templateUrl: 'index-area.html',\n})\nexport class CoreTagIndexAreaPage implements OnInit {\n\n    tagId = 0;\n    tagName = '';\n    collectionId = 0;\n    areaId = 0;\n    fromContextId = 0;\n    contextId = 0;\n    recursive = true;\n\n    areaNameKey = '';\n    loaded = false;\n    componentName?: string;\n    itemType?: string;\n    items: unknown[] = [];\n    nextPage = 0;\n    canLoadMore = false;\n    areaComponent?: Type<unknown>;\n    loadMoreError = false;\n\n    constructor(\n        protected route: ActivatedRoute,\n    ) { }\n\n    /**\n     * View loaded.\n     */\n    async ngOnInit(): Promise<void> {\n        this.route.queryParams.subscribe(async () => {\n            this.loaded = false;\n\n            this.tagId = CoreNavigator.getRouteNumberParam('tagId') || this.tagId;\n            this.tagName = CoreNavigator.getRouteParam('tagName') || this.tagName;\n            this.collectionId = CoreNavigator.getRouteNumberParam('collectionId') || this.collectionId;\n            this.areaId = CoreNavigator.getRouteNumberParam('areaId') || this.areaId;\n            this.fromContextId = CoreNavigator.getRouteNumberParam('fromContextId') || this.fromContextId;\n            this.contextId = CoreNavigator.getRouteNumberParam('contextId') || this.contextId;\n            this.recursive = CoreNavigator.getRouteBooleanParam('recursive') ?? true;\n\n            this.areaNameKey = CoreNavigator.getRouteParam('areaNameKey') || '';\n            // Pass the the following parameters to avoid fetching the first page.\n            this.componentName = CoreNavigator.getRouteParam('componentName');\n            this.itemType = CoreNavigator.getRouteParam('itemType');\n            this.items = CoreNavigator.getRouteParam<unknown[]>('items') || [];\n            this.nextPage = CoreNavigator.getRouteNumberParam('nextPage') || 0;\n            this.canLoadMore = CoreNavigator.getRouteBooleanParam('canLoadMore') || false;\n\n            try {\n                if (!this.componentName || !this.itemType || !this.items.length || this.nextPage == 0) {\n                    await this.fetchData(true);\n                }\n\n                this.areaComponent = await CoreTagAreaDelegate.getComponent(this.componentName!, this.itemType!);\n            } finally {\n                this.loaded = true;\n            }\n        });\n    }\n\n    /**\n     * Fetch next page of the tag index area.\n     *\n     * @param refresh Whether to refresh the data or fetch a new page.\n     * @return Resolved when done.\n     */\n    async fetchData(refresh: boolean = false): Promise<void> {\n        this.loadMoreError = false;\n        const page = refresh ? 0 : this.nextPage;\n\n        try {\n            const areas = await CoreTag.getTagIndexPerArea(\n                this.tagId,\n                this.tagName,\n                this.collectionId,\n                this.areaId,\n                this.fromContextId,\n                this.contextId,\n                this.recursive,\n                page,\n            );\n            const area = areas[0];\n\n            const items = await CoreTagAreaDelegate.parseContent(area.component, area.itemtype, area.content);\n            if (!items || !items.length) {\n                // Tag area not supported.\n                throw Translate.instant('core.tag.errorareanotsupported');\n            }\n\n            if (page == 0) {\n                this.items = items;\n            } else {\n                this.items.push(...items);\n            }\n            this.componentName = area.component;\n            this.itemType = area.itemtype;\n            this.areaNameKey = CoreTagAreaDelegate.getDisplayNameKey(area.component, area.itemtype);\n            this.canLoadMore = !!area.nextpageurl;\n            this.nextPage = page + 1;\n        } catch (error) {\n            this.loadMoreError = true; // Set to prevent infinite calls with infinite-loading.\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading tag index');\n        }\n    }\n\n    /**\n     * Load more items.\n     *\n     * @param infiniteComplete Infinite scroll complete function.\n     * @return Resolved when done.\n     */\n    async loadMore(infiniteComplete?: () => void): Promise<void> {\n        try {\n            await this.fetchData();\n        } finally {\n            infiniteComplete?.();\n        }\n    }\n\n    /**\n     * Refresh data.\n     *\n     * @param refresher Refresher.\n     */\n    async refreshData(refresher?: IonRefresher): Promise<void> {\n        try {\n            await CoreTag.invalidateTagIndexPerArea(\n                this.tagId,\n                this.tagName,\n                this.collectionId,\n                this.areaId,\n                this.fromContextId,\n                this.contextId,\n                this.recursive,\n            );\n        } finally {\n            try {\n                await this.fetchData(true);\n            } finally {\n                refresher?.complete();\n            }\n        }\n    }\n\n}\n"],"sourceRoot":"webpack:///"}